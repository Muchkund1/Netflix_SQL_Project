DROP TABLE IF EXISTS netflix;
CREATE TABLE netflix
(
	show_id	VARCHAR(5),
	type    VARCHAR(10),
	title	VARCHAR(250),
	director VARCHAR(550),
	casts	VARCHAR(1050),
	country	VARCHAR(550),
	date_added	VARCHAR(55),
	release_year	INT,
	rating	VARCHAR(15),
	duration	VARCHAR(15),
	listed_in	VARCHAR(250),
	description VARCHAR(550)
);

select * from netflix

select count(*) as total_count
from netflix

------------------data cleaning-------------------------------------------------------------------
with cte as (
select *,row_number() over(partition by show_id,type,title,director,casts,country,date_added,release_year,rating,duration,listed_in,description) as rn
from netflix) --no repeat data 

select * from cte
where rn >1 

select distinct show_id from netflix
WHERE show_id LIKE 'S%';  --check weather show_id start with Captial S or not


UPDATE netflix   --remove leading and trailing spaces
SET date_added = TRIM(date_added)

select * from netflix
where duration is null
order by rating

UPDATE netflix  --updating the null value
set duration = rating
where duration is null 

select * from netflix
order by rating

select distinct date_added from netflix

UPDATE netflix --, South Korea replace , and space 
SET country = REPLACE(country, ', ', '')
WHERE country = ', South Korea'

-------------------------EDA------------------------------------------------------------------------

select type,count(type) as Count_Movie  -- 1. Count the number of Movies vs TV Shows
from netflix
group by type

select * -- 2. List all movies released in a specific year
from netflix
where release_year = 2021

with cte as ( --3.List all TV shows with more than 5 seasons
select * 
from netflix
where type = 'TV Show')
select * 
from cte
where CAST(SUBSTRING(duration FROM '^[0-9]+') as INT) > 5


with cte2 as ( --4.Find the most common rating for movies and TV shows
with cte as (
select type,rating,count(rating) as rating_count
from netflix
group by type,rating)
select *,row_number() over(partition by type order by rating_count desc) as rn
from cte)

select type,rating as most_frequent_rating
from cte2
where rn = 1
